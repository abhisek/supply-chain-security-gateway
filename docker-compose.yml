version: "3.3"
services:
  envoy:
    image: envoyproxy/envoy:v1.21.1
    command: envoy -c /config/envoy.yml
    volumes:
      - ./config/envoy.yml:/config/envoy.yml
    ports:
      - "10000:10000"
  nats:
    image: nats:2.7-alpine
    ports:
      - "8222:8222"
  pdp:
    build: ./services
    command: pdp-server
    volumes:
      - ./config/global.yml:/config/global.yml
      - ./policies:/policies
    environment:
      GLOBAL_CONFIG_PATH: /config/global.yml
      PDP_POLICY_PATH: /policies
  tap:
    build: ./services
    command: tap-server
    volumes:
      - ./config/global.yml:/config/global.yml
    environment:
      GLOBAL_CONFIG_PATH: /config/global.yml
