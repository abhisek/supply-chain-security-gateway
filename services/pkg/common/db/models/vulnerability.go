package models

import (
	"time"

	"gorm.io/datatypes"
)

const (
	VulnerabilityEcosystemMaven = "maven"
	VulnerabilityEcosystemNpm   = "npm"
	VulnerabilityEcosystemPypi  = "pypi"

	VulnerabilitySchemaTypeOpenSSF = "openssf"
)

type Vulnerability struct {
	ID int64 `gorm:"column:id,autoIncrement"`

	// Lookup key, must be unique
	Ecosystem string `gorm:"column:ecosystem,unique,not null,index:lookup_idx,priority:1"`
	Group     string `gorm:"column:group,unique,not null,index:lookup_idx,priority:2"`
	Name      string `gorm:"column:name,unique,not null,index:lookup_idx,priority:3"`

	// Meta data to deserialize Data into appropriate vulnerability model
	SchemaType    string         `gorm:"column:schema_type,not null"`
	SchemaVersion string         `gorm:"column:schema_version,not null"`
	Data          datatypes.JSON `gorm:"column:data,not null,size:2097152"`

	// Timestamp for vulnerability data from external sources
	DataModifiedAt  time.Time `gorm:"column:data_modified_at"`
	DataPublishedAt time.Time `gorm:"column:data_published_at"`

	// Local timestamps
	CreatedAt time.Time `gorm:"column:created_at,autoUpdateTime"`
	UpdatedAt time.Time `gorm:"column:updated_at,autoCreateTime"`
}
